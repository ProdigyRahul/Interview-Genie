generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String    @id @default(cuid())
  name               String?
  email              String    @unique
  emailVerified      DateTime?
  image              String?
  firstName          String?
  lastName           String?
  phoneNumber        String?
  gender             String?
  country            String?
  state              String?
  city               String?
  pinCode            String?
  workStatus         String?
  experience         String?
  education          String?
  industry           String?
  ageGroup           String?
  aspiration         String?
  hardSkills         Json?     // Store as JSON array
  isProfileComplete  Boolean   @default(false)
  profileProgress    Int       @default(0)
  subscriptionStatus String    @default("free")
  isVerified        Boolean   @default(false)
  credits           Int       @default(100)
  xpPoints           Int       @default(0)
  level             Int       @default(1)
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  lastLogin          DateTime?
  hashedPassword     String?

  // Profile fields
  companyName        String?
  company            String?
  branchName         String?
  cgpa               String?
  passoutYear        String?
  collegeName        String?
  resumeUrl          String?
  cookieConsent      Boolean?
  jobPreference      String?   // "job" or "internship"
  preferredJobLocations Json?  // Array of locations
  preferredIndustries  Json?   // Array of industries
  preferredRoles       Json?   // Array of roles
  bio                 String?  @db.Text
  socialLinks         Json?    // LinkedIn, GitHub, etc.

  // Relations
  accounts Account[]
  sessions Session[]
  resumes             Resume[]
  mockInterviews      MockInterview[]
  interviewNotes      InterviewNote[]
  interviewHistory    InterviewHistory[]
  passwordResetTokens PasswordResetToken[]
  otpVerifications    OTPVerification[]
  education_details   UserEducation?

  @@index([email])
  @@index([isProfileComplete, profileProgress])
  @@index([subscriptionStatus])
  @@index([createdAt])
  @@index([lastLogin])
  @@index([workStatus, industry])
  @@index([experience, education])
  @@index([jobPreference, isVerified])
  @@index([level, xpPoints])
}

model UserEducation {
  id          String   @id @default(cuid())
  userId      String   @unique
  course      String?
  result      String?
  passoutYear String?
  collegeName String?
  branchName  String?
  cgpa        String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([passoutYear])
}

model Admin {
  id                 String              @id @default(cuid())
  email              String              @unique
  firstName          String
  lastName           String
  role               String
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  careerDomains      CareerDomain[]
  interviewScenarios InterviewScenario[]
  jobDescriptions    JobDescription[]
  jobRoles           JobRole[]
}

model CareerDomain {
  id                 String              @id @default(cuid())
  name               String
  description        String?
  isActive           Boolean             @default(true)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  createdById        String
  createdBy          Admin               @relation(fields: [createdById], references: [id])
  interviewScenarios InterviewScenario[]
  jobRoles           JobRole[]
}

model JobRole {
  id              String           @id @default(cuid())
  domainId        String
  title           String
  level           String
  description     String?
  requiredSkills  Json?
  experienceYears Int
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  createdById     String
  jobDescriptions JobDescription[]
  createdBy       Admin            @relation(fields: [createdById], references: [id])
  domain          CareerDomain     @relation(fields: [domainId], references: [id])
  mockInterviews  MockInterview[]
  resumes         Resume[]

  @@index([domainId])
  @@index([isActive])
  @@index([experienceYears])
}

model JobDescription {
  id              String          @id @default(cuid())
  roleId          String
  title           String
  company         String
  description     String
  requirements    Json
  industry        String
  experienceLevel String
  isActive        Boolean         @default(true)
  createdAt       DateTime        @default(now())
  createdById     String
  createdBy       Admin           @relation(fields: [createdById], references: [id])
  role            JobRole         @relation(fields: [roleId], references: [id])
  mockInterviews  MockInterview[]

  @@index([roleId])
  @@index([industry])
  @@index([experienceLevel])
  @@index([isActive])
}

model Resume {
  id         String   @id @default(cuid())
  userId     String
  roleId     String
  resumeUrl  String
  fileType   String
  parsedData Json?
  atsScore   Int?
  uploadedAt DateTime @default(now())
  isCurrent  Boolean  @default(false)
  role       JobRole  @relation(fields: [roleId], references: [id])
  user       User     @relation(fields: [userId], references: [id])
}

model InterviewScenario {
  id             String          @id @default(cuid())
  domainId       String
  title          String
  description    String
  questions      Json
  difficulty     String
  duration       Int
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  createdById    String
  createdBy      Admin           @relation(fields: [createdById], references: [id])
  domain         CareerDomain    @relation(fields: [domainId], references: [id])
  mockInterviews MockInterview[]
}

model MockInterview {
  id                 String             @id @default(cuid())
  userId             String
  jobId              String
  roleId             String
  scenarioId         String
  startTime          DateTime
  endTime            DateTime?
  interviewType      String
  status             String
  score              Int?
  feedback           Json?
  duration           Int?
  technicalScore     Float?
  behavioralScore    Float?
  communicationScore Float?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  history            InterviewHistory[]
  notes              InterviewNote[]
  recordings         MediaRecording[]
  job                JobDescription     @relation(fields: [jobId], references: [id])
  role               JobRole            @relation(fields: [roleId], references: [id])
  scenario           InterviewScenario  @relation(fields: [scenarioId], references: [id])
  user               User               @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([status])
  @@index([startTime])
  @@index([interviewType])
}

model Account {
  id                       String  @id @default(cuid())
  userId                   String
  type                     String
  provider                 String
  providerAccountId        String
  refresh_token            String?
  access_token             String?
  expires_at               Int?
  token_type               String?
  scope                    String?
  id_token                 String?
  session_state            String?
  refresh_token_expires_in Int?
  user                     User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
  @@index([provider])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expires])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model InterviewHistory {
  id          String        @id @default(cuid())
  userId      String
  interviewId String
  action      String
  timestamp   DateTime
  metadata    Json?
  createdAt   DateTime      @default(now())
  interview   MockInterview @relation(fields: [interviewId], references: [id])
  user        User          @relation(fields: [userId], references: [id])
}

model InterviewNote {
  id          String        @id @default(cuid())
  interviewId String
  userId      String
  content     String
  timestamp   Int?
  noteType    String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  interview   MockInterview @relation(fields: [interviewId], references: [id])
  user        User          @relation(fields: [userId], references: [id])
}

model MediaRecording {
  id           String              @id @default(cuid())
  interviewId  String
  mediaType    String
  fileUrl      String
  thumbnailUrl String?
  duration     Int
  fileSize     BigInt
  format       String
  quality      String
  status       String
  createdAt    DateTime            @default(now())
  archivedAt   DateTime?
  interview    MockInterview       @relation(fields: [interviewId], references: [id])
  analysis     RecordingAnalysis[]
  segments     RecordingSegment[]
}

model RecordingSegment {
  id          String         @id @default(cuid())
  recordingId String
  startTime   Int
  endTime     Int
  segmentUrl  String
  transcript  String?
  highlights  Json?
  createdAt   DateTime       @default(now())
  recording   MediaRecording @relation(fields: [recordingId], references: [id])
}

model RecordingAnalysis {
  id                 String         @id @default(cuid())
  recordingId        String
  analysisType       String
  confidenceScore    Float
  clarityScore       Float
  paceScore          Float
  voiceToneAnalysis  Json?
  fillerWordsCount   Int
  silencePeriods     Json?
  volumeVariance     Json?
  languageConfidence Float
  facialExpressions  Json?
  eyeContactScore    Float?
  postureAnalysis    Json?
  gestureMetrics     Json?
  createdAt          DateTime       @default(now())
  recording          MediaRecording @relation(fields: [recordingId], references: [id])
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  expires   DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
}

model OTPVerification {
  id        String   @id @default(cuid())
  userId    String
  otp       String
  expires   DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

